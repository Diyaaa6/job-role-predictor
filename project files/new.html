<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Role Predictor - Authentication</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7; 
        }
        .wavy-bg {
            position: absolute;
            bottom: 0;
            left: 0;
            z-index: -10;
        }
        .auth-tab {
            @apply px-4 py-2 font-semibold transition-all duration-200 cursor-pointer text-gray-600 hover:text-[#8A2BE2];
        }
        .auth-tab.active {
            @apply text-[#8A2BE2] border-b-2 border-[#8A2BE2];
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen text-gray-800 relative overflow-hidden">
    <div class="wavy-bg w-[500px] h-[400px] rounded-tr-[50%] rounded-br-[50%] bg-[#9B51E0] transform -translate-x-1/2 translate-y-1/3 rotate-12 opacity-70"></div>
    <div class="wavy-bg w-[600px] h-[500px] rounded-tr-[50%] rounded-br-[50%] bg-[#8A2BE2] transform -translate-x-1/3 translate-y-1/2 rotate-6 opacity-80"></div>
    <div class="wavy-bg w-[700px] h-[600px] rounded-tr-[50%] rounded-br-[50%] bg-[#6A0DAD] transform -translate-x-1/4 translate-y-2/3 rotate-0 opacity-90"></div>
    <div id="main-app-container" class="relative flex w-full max-w-5xl min-h-[600px] bg-white rounded-3xl shadow-2xl overflow-hidden z-10 transition-all duration-500">
        <div id="left-panel" class="w-1/2 flex flex-col items-center justify-center p-8 relative transition-all duration-500">
            <h1 class="text-6xl font-extrabold text-[#6A0DAD] mb-2 z-10" id="left-panel-title">Login</h1>
        </div>
        <div id="right-content-panel" class="w-1/2 flex flex-col items-center justify-start p-8 bg-gray-50/50 rounded-r-3xl transition-all duration-500">
            <div id="auth-tabs" class="w-full max-w-sm flex justify-around mb-8 border-b border-gray-200">
                <button id="show-login-btn" class="auth-tab active">Sign In</button>
                <button id="show-register-btn" class="auth-tab">Sign Up</button>
            </div>
            <div id="login-view" class="w-full max-w-sm space-y-6">
                <form id="login-form" class="space-y-6">
                    <div>
                        <div class="relative flex items-center border border-gray-300 rounded-xl shadow-sm focus-within:ring-2 focus-within:ring-[#8A2BE2] transition-all duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-4 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            <input type="email" id="login-email" value="test@example.com" placeholder="Email" required 
                                class="w-full pl-12 pr-4 py-3 bg-transparent rounded-xl outline-none text-lg">
                        </div>
                    </div>
                    <div>
                        <div class="relative flex items-center border border-gray-300 rounded-xl shadow-sm focus-within:ring-2 focus-within:ring-[#8A2BE2] transition-all duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-4 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v3h8z" />
                            </svg>
                            <input type="password" id="login-password" value="password123" placeholder="Password" required 
                                class="w-full pl-12 pr-4 py-3 bg-transparent rounded-xl outline-none text-lg">
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <div class="flex items-center">
                            <input id="remember-me" name="remember-me" type="checkbox" 
                                class="h-4 w-4 text-[#8A2BE2] focus:ring-[#8A2BE2] border-gray-300 rounded">
                            <label for="remember-me" class="ml-2 block text-gray-600">Save my password</label>
                        </div>
                    </div>
                    <button type="submit" class="w-full flex justify-center items-center py-3 px-4 border border-transparent 
                                               rounded-xl shadow-lg text-lg font-semibold text-white 
                                               bg-[#8A2BE2] hover:bg-[#6A0DAD] focus:outline-none focus:ring-2 
                                               focus:ring-offset-2 focus:ring-[#8A2BE2] transition duration-200 transform hover:scale-[1.01]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                        Sign In
                    </button>
                </form>
            </div>
            <div id="register-view" class="w-full max-w-sm space-y-6 hidden">
                <form id="register-form" class="space-y-6">
                    <div>
                        <div class="relative flex items-center border border-gray-300 rounded-xl shadow-sm focus-within:ring-2 focus-within:ring-[#8A2BE2] transition-all duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-4 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <input type="text" id="register-username" placeholder="Username" required 
                                class="w-full pl-12 pr-4 py-3 bg-transparent rounded-xl outline-none text-lg">
                        </div>
                    </div>
                    <div>
                        <div class="relative flex items-center border border-gray-300 rounded-xl shadow-sm focus-within:ring-2 focus-within:ring-[#8A2BE2] transition-all duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-4 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            <input type="email" id="register-email" placeholder="Email" required 
                                class="w-full pl-12 pr-4 py-3 bg-transparent rounded-xl outline-none text-lg">
                        </div>
                    </div>
                    <div>
                        <div class="relative flex items-center border border-gray-300 rounded-xl shadow-sm focus-within:ring-2 focus-within:ring-[#8A2BE2] transition-all duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-4 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v3h8z" />
                            </svg>
                            <input type="password" id="register-password" placeholder="Password" required 
                                class="w-full pl-12 pr-4 py-3 bg-transparent rounded-xl outline-none text-lg">
                        </div>
                    </div>
                    <button type="submit" class="w-full flex justify-center items-center py-3 px-4 border border-transparent 
                                               rounded-xl shadow-lg text-lg font-semibold text-white 
                                               bg-[#8A2BE2] hover:bg-[#6A0DAD] focus:outline-none focus:ring-2 
                                               focus:ring-offset-2 focus:ring-[#8A2BE2] transition duration-200 transform hover:scale-[1.01]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                        </svg>
                        Register
                    </button>
                </form>
            </div>
            <div id="profile-view" class="w-full h-full p-8 hidden flex flex-col items-center justify-start space-y-6">
                <div class="w-full p-6 bg-indigo-50 border-l-4 border-indigo-500 rounded-lg shadow-inner">
                    <p class="text-2xl font-bold text-indigo-800 mb-2">Authenticated Dashboard</p>
                    <p class="text-sm text-indigo-700">This view shows the content loaded after successful JWT authentication.</p>
                </div>
                <button id="fetch-profile-data-btn" class="w-full max-w-sm flex justify-center py-3 px-4 border border-transparent 
                                                        rounded-xl shadow-lg text-lg font-semibold text-white 
                                                        bg-blue-600 hover:bg-blue-700 transition duration-200 transform hover:scale-[1.01]">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" id="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Fetch Protected Data (/profile)
                </button>
                <div id="profile-data-output" class="w-full max-w-sm p-4 bg-gray-100 rounded-lg text-sm text-gray-800 overflow-x-auto whitespace-pre-wrap shadow-inner">
                    JWT access results will appear here.
                </div>
                <button id="logout-btn" class="w-full max-w-sm flex justify-center py-3 px-4 border border-transparent 
                                            rounded-xl shadow-sm text-lg font-semibold text-indigo-600 bg-indigo-100 
                                            hover:bg-indigo-200 transition duration-150 transform hover:scale-[1.01]">
                    Logout
                </button>
            </div>

        </div>
    </div>

    <div id="message-box" class="fixed top-8 right-8 z-50 transition-transform duration-300 transform translate-x-full">
        <div class="shadow-xl rounded-lg p-4 max-w-sm w-full" role="alert">
            <p id="message-text" class="text-sm font-medium"></p>
        </div>
    </div>
    <script>
        const API_BASE_URL = 'http://localhost:3000';
        const mainAppContainer = document.getElementById('main-app-container');
        const leftPanel = document.getElementById('left-panel');
        const leftPanelTitle = document.getElementById('left-panel-title');
        const leftPanelSubtitle = document.getElementById('left-panel-subtitle');
        const rightContentPanel = document.getElementById('right-content-panel');
        const loginView = document.getElementById('login-view');
        const registerView = document.getElementById('register-view');
        const profileView = document.getElementById('profile-view');
        const showLoginBtn = document.getElementById('show-login-btn');
        const showRegisterBtn = document.getElementById('show-register-btn');
        const fetchProfileDataBtn = document.getElementById('fetch-profile-data-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const spinner = document.getElementById('spinner');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginEmailInput = document.getElementById('login-email');
        const loginPasswordInput = document.getElementById('login-password');
        function showMessage(message, type = 'info') {
            const box = document.getElementById('message-box');
            const text = document.getElementById('message-text');
            text.textContent = message;
            box.style.transform = 'translateX(0)';
            let bgColor = 'bg-gray-700';
            let textColor = 'text-white';
            if (type === 'success') {
                bgColor = 'bg-green-500';
            } else if (type === 'error') {
                bgColor = 'bg-red-500';
            } else if (type === 'info') {
                bgColor = 'bg-blue-500';
            }
            
            box.querySelector('div').className = `shadow-xl rounded-lg p-4 max-w-sm w-full ${bgColor}`;
            text.className = `text-sm font-medium ${textColor}`;
            setTimeout(() => {
                box.style.transform = 'translateX(100%)';
            }, 4000);
        }
        function navigate(viewName) {
            loginView.classList.add('hidden');
            registerView.classList.add('hidden');
            profileView.classList.add('hidden');
            showLoginBtn.classList.remove('active');
            showRegisterBtn.classList.remove('active');
            leftPanel.classList.remove('hidden', 'w-0');
            rightContentPanel.classList.remove('w-full', 'items-start');
            rightContentPanel.classList.add('w-1/2');
            mainAppContainer.classList.add('min-h-[600px]');
            document.getElementById('auth-tabs').classList.remove('hidden');
            if (viewName === 'login') {
                loginView.classList.remove('hidden');
                showLoginBtn.classList.add('active');
                leftPanelTitle.textContent = 'Login Page';
                leftPanelSubtitle.textContent = 'Design';
            } else if (viewName === 'register') {
                registerView.classList.remove('hidden');
                showRegisterBtn.classList.add('active');
                leftPanelTitle.textContent = 'Sign Up';
                leftPanelSubtitle.textContent = 'New Account';
            } else if (viewName === 'profile') {
                profileView.classList.remove('hidden');
                leftPanel.classList.add('hidden', 'w-0');
                rightContentPanel.classList.remove('w-1/2');
                rightContentPanel.classList.add('w-full', 'items-start');
                document.getElementById('auth-tabs').classList.add('hidden');
                mainAppContainer.classList.remove('min-h-[600px]');
                mainAppContainer.classList.add('min-h-0');
            }
        }
        function checkAuthStatus() {
            const token = localStorage.getItem('jwtToken');
            if (token) {
                navigate('profile');
                fetchProfileData();
            } else {
                navigate('login');
            }
        }
        async function handleRegister(e) {
            e.preventDefault();
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const username = document.getElementById('register-username').value;
            try {
                const res = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, username })
                });
                if (res.ok) {
                    const data = await res.json();
                    showMessage(data.message, 'success');
                    navigate('login');
                    registerForm.reset();
                } else {
                    const error = await res.json();
                    showMessage(`Registration failed: ${error.message || res.statusText}`, 'error');
                }
            } catch (error) {
                showMessage(`Network error: ${error.message}`, 'error');
            }
        }
        async function handleLogin(e) {
            e.preventDefault();
            const email = loginEmailInput.value;
            const password = loginPasswordInput.value;
            try {
                const res = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password }) 
                });
                if (res.ok) {
                    const data = await res.json();
                    localStorage.setItem('jwtToken', data.token);
                    showMessage('Login successful!', 'success');
                    navigate('profile');
                    fetchProfileData();
                } else {
                    const error = await res.json();
                    showMessage(`Login failed: Invalid Credentials.`, 'error'); 
                }
            } catch (error) {
                showMessage(`Network error. Is the backend running on ${API_BASE_URL}?`, 'error');
            }
        }
        async function fetchProfileData() {
            const token = localStorage.getItem('jwtToken');
            const output = document.getElementById('profile-data-output');
            output.textContent = 'Fetching protected data...';
            spinner.classList.remove('hidden');
            fetchProfileDataBtn.disabled = true;
            if (!token) {
                output.textContent = 'Error: No JWT token found.';
                showMessage('Session expired. Please login.', 'error');
                navigate('login');
                spinner.classList.add('hidden');
                fetchProfileDataBtn.disabled = false;
                return;
            }
            try {
                const res = await fetch(`${API_BASE_URL}/profile`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                if (res.ok) {
                    const data = await res.json();
                    showMessage('Protected data fetched successfully!', 'success');
                    output.textContent = JSON.stringify(data, null, 2);
                } else {
                    const error = await res.json();
                    showMessage(`Access Denied: ${error.message || res.statusText}`, 'error');
                    output.textContent = `Error: ${error.message || 'Forbidden'}. Token invalid or expired.`;
                    if (res.status === 403 || res.status === 401) {
                        localStorage.removeItem('jwtToken');
                        setTimeout(() => navigate('login'), 2000);
                    }
                }
            } catch (error) {
                showMessage(`Network error: ${error.message}`, 'error');
                output.textContent = `Network Error: ${error.message}`;
            } finally {
                spinner.classList.add('hidden');
                fetchProfileDataBtn.disabled = false;
            }
        }
        function handleLogout() {
            localStorage.removeItem('jwtToken');
            showMessage('Logged out successfully.', 'info');
            document.getElementById('profile-data-output').textContent = 'JWT access results will appear here.';
            navigate('login');
        }
        loginForm.addEventListener('submit', handleLogin);
        registerForm.addEventListener('submit', handleRegister);
        showLoginBtn.addEventListener('click', () => navigate('login'));
        showRegisterBtn.addEventListener('click', () => navigate('register'));
        fetchProfileDataBtn.addEventListener('click', fetchProfileData);
        logoutBtn.addEventListener('click', handleLogout);
        window.onload = checkAuthStatus;
    </script>
</body>
</html>